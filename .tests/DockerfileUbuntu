FROM ubuntu:bionic as base
RUN apt-get update && apt-get install -y \
    git \
    curl \
    python3 python3-pip python3-venv redis-server \
    && curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python3 \
    && git clone --single-branch --branch v1.0.0 --depth 1 https://github.com/checktheroads/hyperglass
ENV PATH="$PATH:$HOME/.poetry/bin"

FROM base
WORKDIR ./hyperglass
ENV python=python3
RUN ln -s $(which python3) /usr/bin/python \
    && python --version \
    && $HOME/.poetry/bin/poetry install --no-ansi \
    && $HOME/.poetry/bin/poetry run hyperglass setup -d
EXPOSE 8001
CMD poetry run hyperglass start
